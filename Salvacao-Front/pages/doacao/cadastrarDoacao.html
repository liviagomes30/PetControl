<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PetControl - Cadastrar Adoção</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <script src="../../assets/js/components/sidebar.js" defer></script>
  </head>
  <body>
    <div class="container">
      <div class="header d-flex align-items-center">
        <a href="listarDoacao.html" class="btn btn-secondary me-3">
          <i class="bi bi-arrow-left"></i> Voltar
        </a>
        <h1 class="h3 mb-0" style="color: var(--vermelho-escuro)">
          Cadastrar Adoção
        </h1>
      </div>

      <div class="bg-white shadow rounded p-4">
        <form id="formAdocao">
            <!-- Primeira linha: Adotante e Animal -->>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="idadotante" class="form-label" style="color: red;">*ID do Adotante</label>
                    <input type="number" class="form-control" id="idadotante" required min="1" />
                    <div id="idadotanteError" class="input-error"></div>
                </div>

                <div class="col-md-6">
                    <label for="idanimal" class="form-label" style="color: red;">*ID do Animal</label>
                    <input type="number" class="form-control" id="idanimal" required min="1" />
                    <div id="idanimalError" class="input-error"></div>
                </div>
            </div>

            <!-- Segunda linha: Datas -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="dataadocao" class="form-label" style="color: red;">*Data de Adoção</label>
                    <input type="date" class="form-control" id="dataadocao" required />
                    <div id="dataadocaoError" class="input-error"></div>
                </div>

                <div class="col-md-6">
                    <label for="data_acompanhamento" class="form-label">Data de Acompanhamento</label>
                    <input type="date" class="form-control" id="data_acompanhamento" />
                    <div id="data_acompanhamentoError" class="input-error"></div>
                </div>
            </div>

            <!-- Terceira linha: Pessoa e Status -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="pessoa_idpessoa" class="form-label">ID da Pessoa Responsável</label>
                    <input type="number" class="form-control" id="pessoa_idpessoa" min="1" />
                    <div id="pessoa_idpessoaError" class="input-error"></div>
                </div>

                <div class="col-md-6">
                    <label for="status_acompanhamento" class="form-label" style="color: red;">*Status do Acompanhamento</label>
                    <select class="form-select" id="status_acompanhamento" required>
                        <option value="">Selecione o status</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em acompanhamento">Em acompanhamento</option>
                        <option value="Aprovado">Aprovado</option>
                        <option value="Rejeitado">Rejeitado</option>
                        <option value="Cancelado">Cancelado</option>
                    </select>
                    <div id="status_acompanhamentoError" class="input-error"></div>
                </div>
            </div>

            <!-- Observações -->
            <div class="mb-3">
                <label for="obs" class="form-label">Observações</label>
                <textarea 
                    class="form-control" 
                    id="obs" 
                    rows="4" 
                    data-max-length="500" 
                    data-show-counter="true"
                    placeholder="Digite observações sobre a adoção..."
                ></textarea>
                <div id="obsError" class="input-error"></div>
            </div>

            <!-- Botões -->
            <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='listarAdocao.html'">
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">Confirmar</button>
            </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        // import { adocaoController } from "../../assets/js/controllers/AdocaoController.js"; 
        // import UIComponents from "../../assets/js/components/uiComponents.js";

        // Aguarda o carregamento do DOM
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("formAdocao");

            // Definir data atual como padrão para data de adoção
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataadocao').value = hoje;

            // Adiciona o listener de submit
            if (form) {
                form.addEventListener("submit", (event) => {
                    event.preventDefault(); // Evita o envio padrão do formulário

                    try {
                        // adocaoController.cadastrar(event); // Chama o método cadastrar
                        console.log("Cadastrando adoção...");
                        
                        // Simular sucesso
                        setTimeout(() => {
                            window.location.href = 'listarAdocao.html?message=Adoção cadastrada com sucesso!';
                        }, 1000);
                        
                    } catch (error) {
                        console.error("Erro ao cadastrar adoção:", error);
                        // UIComponents.alertaErro("Erro ao cadastrar adoção. Verifique os campos.");
                        alert("Erro ao cadastrar adoção. Verifique os campos.");
                    }
                });
            }

            // Contador de caracteres para textarea
            const textarea = document.getElementById('obs');
            const maxLength = textarea.getAttribute('data-max-length');
            
            // Criar elemento contador
            const counter = document.createElement('small');
            counter.className = 'text-muted';
            counter.style.float = 'right';
            textarea.parentNode.appendChild(counter);
            
            function updateCounter() {
                const remaining = maxLength - textarea.value.length;
                counter.textContent = `${textarea.value.length}/${maxLength}`;
                counter.style.color = remaining < 50 ? '#dc3545' : '#6c757d';
            }
            
            textarea.addEventListener('input', updateCounter);
            updateCounter(); // Inicializar contador
        });
    </script>
  </body>
</html>